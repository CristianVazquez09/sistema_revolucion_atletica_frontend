<!-- Botonera superior -->
<div class="flex gap-4 px-4 md:px-8 mb-4">
  <button class="px-5 py-2 rounded-md bg-red-600 text-white shadow-md hover:bg-red-700">
    Agregar Socio
  </button>

  <button class="px-5 py-2 rounded-md bg-red-600 text-white shadow-md hover:bg-red-700">
    Reinscripción
  </button>

  <button class="px-5 py-2 rounded-md bg-red-600 text-white shadow-md hover:bg-red-700">
    Historial
  </button>
</div>


<!-- Card principal -->
<div class="mx-4 md:mx-8 mt-4 rounded-xl2 bg-white ring-1 ring-black/10 shadow-card">
  <div class="px-6 py-4 border-b border-gray-200">
    <h2 class="text-xl font-semibold text-ra-slate">Agregar Usuario</h2>
  </div>

  <form class="p-6 space-y-4" [formGroup]="formularioInscripcion">
    <!-- Nombre / Apellido -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input formControlName="nombre" placeholder="Nombre*" class="input-filled">
      <input formControlName="apellido" placeholder="Apellidos*" class="input-filled">
    </div>

    <!-- Teléfono / Correo / Fecha nac -->
    <div class="grid grid-cols-1 md:grid-cols-[1fr_1fr_1fr] gap-4">
      <input formControlName="telefono" placeholder="Teléfono*" class="input-filled">
      <input formControlName="email" placeholder="Correo*" class="input-filled">
      <input type="date" formControlName="fechaNacimiento" placeholder="Fecha de nacimiento" class="input-filled">
    </div>

    <!-- Dirección + Sexo -->
    <div class="grid grid-cols-1 md:grid-cols-[1fr_auto] gap-4 items-center">
      <input formControlName="direccion" placeholder="Dirección*" class="input-filled">

      <div class="text-sm text-ra-slate">
        <span class="font-semibold mr-2">Sexo</span>
        <label class="mr-4 inline-flex items-center gap-2">
          <input type="radio" value="MASCULINO" formControlName="genero" class="accent-red-600"> Masculino
        </label>
        <label class="inline-flex items-center gap-2">
          <input type="radio" value="FEMENINO" formControlName="genero" class="accent-red-600"> Femenino
        </label>
      </div>
    </div>

    <!-- ======= Fila en 4 columnas: Foto | Huella | Comentarios | Paquete+Descuento+FechaPago ======= -->
    <div class="grid grid-cols-1 xl:grid-cols-[260px_260px_1.1fr_1.2fr] gap-4 items-stretch">

      <!-- 1) Foto -->
      <div class="rounded-xl2 border border-gray-300 bg-gray-50 p-2 aspect-square">
        @if (fotoPreviewUrl) {
        <div class="relative w-full h-full">
          <img [src]="fotoPreviewUrl" alt="Foto" class="absolute inset-0 w-full h-full object-cover rounded-xl2" />
          <div class="absolute bottom-2 left-0 right-0 flex justify-center gap-2">
            <label class="px-3 py-1.5 rounded-md bg-white/90 border cursor-pointer hover:bg-white">
              Cambiar
              <input type="file" accept="image/*" class="hidden" (change)="onFotoSeleccionada($event)">
            </label>
            <button type="button" class="px-3 py-1.5 rounded-md bg-white/90 border hover:bg-white"
              (click)="quitarFoto()">Quitar</button>
          </div>
        </div>
        } @else {
        <div class="w-full h-full grid place-items-center text-center">
          <div>
            <div class="mx-auto mb-3 h-12 w-12  grid place-items-center">
              <img src="iconos/subir-archivo.svg" alt="Icono calendario" class="w-6 h-6 text-white" />
            </div>
            <label class="px-4 py-2 rounded-md  text-gray-700 hover:bg-gray-200">
              Subir archivo
              <input type="file" accept="image/*" class="hidden" (change)="onFotoSeleccionada($event)">
            </label>
          </div>
        </div>
        }
      </div>

      <!-- 2) Huella -->
      <div class="rounded-xl2 border border-gray-300 bg-gray-50 p-2 aspect-square">
        <div class="w-full h-full grid place-items-center text-center">
          <div>
            <div class="mx-auto mb-3 h-12 w-12 rounded-full bg-gray-200 grid place-items-center">
              <svg viewBox="0 0 24 24" class="h-6 w-6 text-gray-600" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c1.657 0 3 1.343 3 3v4" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 9a3 3 0 016 0v2" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 12a5 5 0 0110 0v2" />
              </svg>
            </div>
            <button type="button" class="px-4 py-2 rounded-md bg-gray-200 text-gray-700 cursor-not-allowed"
              title="Próximamente">
              Ingresar huella
            </button>
          </div>
        </div>
      </div>

      <!-- 3) Comentarios -->
      <div class="flex">
        <textarea formControlName="comentarios" class="input-filled h-full min-h-[260px] resize-none w-full"
          placeholder="Comentarios*"></textarea>
      </div>

      <!-- 4) Paquete + Descuento + Fecha de pago (solo lectura) -->
      <div class="h-full flex flex-col">
        <select formControlName="paqueteId" class="input-filled">
          <option [ngValue]="0" disabled>Seleccionar paquete</option>
          @for (p of listaPaquetes; track p.idPaquete) {
          <option [ngValue]="p.idPaquete">{{ p.nombre ?? ('Paquete #' + p.idPaquete) }}</option>
          }
        </select>

        <input type="number" step="0.01" formControlName="descuento" placeholder="Descuento*" class="input-filled mt-3">

        <label class="block text-sm font-semibold text-ra-slate mt-3 mb-1">Fecha de pago</label>
        <div class="input-filled bg-gray-100 pointer-events-none select-none">
          {{ fechaPagoVista() | date:'dd/MM/yyyy' }}
        </div>

        <!-- Conservamos el control en el form pero oculto -->
        <input type="hidden" formControlName="fechaInicio">
      </div>
    </div>
    <!-- ======= /Fila 4 columnas ======= -->

    <!-- Resumen de importes -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
      <div class="rounded-lg bg-gray-50 border border-gray-200 p-3">
        <div class="text-gray-600">Precio paquete</div>
        <div class="font-semibold">${{ precioPaquete() | number:'1.2-2' }}</div>
      </div>
      <div class="rounded-lg bg-gray-50 border border-gray-200 p-3">
        <div class="text-gray-600">Inscripción</div>
        <div class="font-semibold">${{ costoInscripcion() | number:'1.2-2' }}</div>
      </div>
      <div class="rounded-lg bg-gray-50 border border-gray-200 p-3">
        <div class="text-gray-600">Total (con descuento)</div>
        <div class="font-bold text-ra-slate">${{ totalVista() | number:'1.2-2' }}</div>
      </div>
    </div>

    <!-- Mensaje de error de validación previa -->
    @if (mensajeError) {
    <div class="text-red-600 text-sm mt-2">{{ mensajeError }}</div>
    }

    <!-- Botón centrado -->
    <div class="pt-4 flex justify-center">
      <button type="button" (click)="abrirModalResumen()"
        class="px-8 py-2.5 rounded-md bg-red-600 text-white hover:bg-red-700">
        Continuar con el pago
      </button>
    </div>
  </form>
</div>

<!-- Modal Resumen -->
@if (mostrarModalResumen()) {
<div class="fixed inset-0 z-50 flex items-center justify-center" (click)="cerrarModalResumen()">
  <div class="absolute inset-0 bg-black/50 backdrop-blur-[2px]"></div>
  <div class="relative z-10 w-full max-w-[560px] mx-4" (click)="$event.stopPropagation()">
    <app-resumen-compra
      [socioNombre]="formularioInscripcion.controls.nombre.value + ' ' + formularioInscripcion.controls.apellido.value"
      [fechaPago]="fechaPagoVista()" [concepto]="paqueteSeleccionado()?.nombre ?? 'Paquete seleccionado'"
      [montoPaquete]="precioPaquete()" [montoInscripcion]="costoInscripcion()" [descuento]="descuentoSig() ?? 0"
      [total]="totalVista()" [guardando]="guardandoMembresia" (cancelar)="cerrarModalResumen()"
      (confirmar)="confirmarPagoYGuardar($event)">
    </app-resumen-compra>
  </div>
</div>
}